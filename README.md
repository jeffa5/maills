# Maills: Mail language server

A tool to help with writing emails.

## Actions

- [x] `hover` shows a summary of the contact
- [x] `gotoDefinition` of an email address to view the vcard
- [x] completion for email addresses, and contact names
- [x] diagnostics for addresses not in your contacts
- [ ] code action to add addresses to contacts
    - [x] create new contact if email is not with existing contact
    - [ ] add email to existing contact

## Installation

### Cargo

Currently, the main way to install maills is by cloning the repo and running

```sh
cargo install --force maills
```

This adds the binary `maills` to the rust bin location.

### Nix

You can also get it on nix, using the flake in this repo:

```sh
nix shell github:jeffa5/maills
```

## Configuration

Capabilities are all enabled by default, but can be disabled in the `initializationOptions` (e.g. to prevent conflicting handling of `hover` or `gotoDefinition`):

```json
{
  "vcard_dir": "~/path/to/contacts",
  "contact_list_file": "~/path/to/contacts_list",
  "contact_list_diagnostics": false,
  "enable_completion": false,
  "enable_hover": false,
  "enable_code_actions": false,
  "enable_goto_definition": false
}
```

Sources can currently either be from a directory of VCards, or from a contact list file.

#### VCards directory

A simple directory with files having the extension `vcf`.
It does not recurse.
Each file can have multiple VCards within, but when creating a contact (through LSP actions) they are created one per file.

#### Contacts list file

A file using the format from `mu cfind --format=plain`.
Each line in the file is a contact, with the name first and email after.
No quotes are used, `maills` skips empty lines and parses the email as the last string in the line after splitting on spaces.

No contact creation is planned for this source as it is typically autogenerated.
Diagnostics are also skipped for this source.

### Neovim

For debugging and quickly adding it to neovim you can use the provided `vim.lua` file, provided you have `nvim-lspconfig`.
Just make sure to run `cargo build` and enter `nvim` from the root of this repo.

```sh
nvim test.eml
# then :LspStop
# then :luafile vim.lua
# then :LspStart
# Write some words and hit K to hover one
```

It by default is set up for the `mail` filetype.
